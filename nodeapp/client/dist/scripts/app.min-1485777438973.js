angular.module("myApp.directives",[]),angular.module("myApp.services",[]),angular.module("myApp.resources",["ngResource"]),angular.module("myApp.controllers",[]),angular.module("myApp.filters",[]);var modulesList=["ui.router","ui.bootstrap","angular-growl","myApp.controllers","myApp.directives","myApp.services","myApp.filters","myApp.resources"],socket=io.connect(myAppGlobals.baseUrl),myAppResource=function(e){return e("/",{},myAppGlobals.resourceList)};angular.module("myApp.resources").factory("myAppResource",["$resource",myAppResource]),angular.module("myApp",modulesList).config(["$stateProvider","$urlRouterProvider",function(e,r){_.each(myAppGlobals.states,function(r){e.state(r)}),r.otherwise(myAppGlobals.defaultState)}]).config(["$httpProvider",function(e){e.defaults.useXDomain=!0,delete e.defaults.headers.common["X.Requested-With"],e.interceptors.push("interceptorService")}]).config(["$locationProvider",function(e){}]).run(["$rootScope","$location","$window","$state","logService","utilsService",function(e,r,o,t,n,a){if(e.constraints={},_.each(myAppGlobals.resourceList,function(r,o){e.constraints[o]=r.constraints}),e.baseUrl=myAppGlobals.baseUrl,e.version=myAppGlobals.version,e.severErrorOccurred=!1,e.displaySeverErrorMessage=!1,e.clientDebug=myAppGlobals.clientDebug,e.appConfigs=myAppGlobals.appConfigs,e.loggedInRole=[],myAppGlobals.loggedIn===!0?(e.loggedIn=!0,e.account=myAppGlobals.account,e.loggedInRole=myAppGlobals.roleList[myAppGlobals.account.role],socket.on("connect",function(e){socket.emit("storeClientInfo",{userId:myAppGlobals.account._id})}),"admin"==myAppGlobals.account.role&&socket.on("userInfo",function(r){e.$broadcast("onlineuser-updated",r)})):e.loggedIn=!1,e.modalInstances={},e.openModal=function(r){e.modalInstances[r.modalName]=a.openModal(r)},e.closeModal=function(r){return!!e.modalInstances[r]&&(a.closeModal(e.modalInstances[r]),!0)},e.$on("$stateChangeStart",function(r,o,t,n,a){e.previousState={state:n,params:a}}),e.loggedIn===!1){var l=!1,s=r.path().split("/")[1];r.path()&&_.each(e.routesList,function(e){s==e.split("/")[1]&&(l=!0)})}e.$on("event::exception-occurred",function(r,o){e.displaySeverErrorMessage=!0,e.severErrorOccurred===!1&&n.makeLog({makeLog:{log:o}},function(r,o){e.severErrorOccurred=!0}),e.severErrorOccurred=!0}),e.goTo=function(e,r){t.go(e,r,{notify:!0,location:!0,reload:!0})},e.reloadLanding=function(e){o.location="/"},e.validatePassword=function(e){return a.validatePassword(e)},e.checkRole=function(r){return _.contains(e.loggedInRole,r.toLowerCase())},e.constraint={password:{presence:!0,format:{pattern:/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[^\w\s]).{8,}$/,message:"must conatins uppercase, lowercase, number and special characters"},length:{minimum:8,message:"must contain 8 characters"}}},e.validate=validate}]);var accountService=function(e,r){return{signIn:function(o,t){var n=r.validateInput("signIn",o);if(0==n.length){var a=e.signIn({signIn:o});a.$promise.then(r.successCallBack(t),r.errorCallBack(t))}else t(n,null)},updateUser:function(o,t){var n=r.validateInput("updateUser",o);if(0==n.length){var a=e.updateUser({updateUser:o});a.$promise.then(r.successCallBack(t),r.errorCallBack(t))}else t(n,null)},signUp:function(o,t){var n=r.validateInput("signUp",o);if(0==n.length){var a=e.signUp({signUp:o});a.$promise.then(r.successCallBack(t),r.errorCallBack(t))}else t(n,null)},getUserList:function(o,t){var n=r.validateInput("getUserList",o);if(0==n.length){var a=e.getUserList({getUserList:o});a.$promise.then(r.successCallBack(t),r.errorCallBack(t))}else t(n,null)},logout:function(o){var t=e.logout();t.$promise.then(r.successCallBack(o),r.errorCallBack(o))},validateEmail:function(r){var o={email:r},t=e.validateEmail(o);return t},validateUserName:function(r){var o={userName:r},t=e.validateUserName(o);return t}}};angular.module("myApp.services").factory("accountService",["myAppResource","utilsService",accountService]);var interceptorService=function(e,r,o){return{request:function(e){return e.timeout=6e4,e.headers=e.headers||{},myAppGlobals.jwt&&(e.headers.authorization="Bearer "+myAppGlobals.jwt),e},responseError:function(t){var n;return 500==t.status||503==t.status||0==t.status?(e.$broadcast("event::exception-occurred",t),n=r.reject(t)):404==t.status||400==t.status?n=r.reject(t):403!=t.status?t:void(o.location="/")},response:function(e){return e}}};angular.module("myApp.services").factory("interceptorService",["$rootScope","$q","$window",interceptorService]);var logService=function(e,r){return{makeLog:function(o,t){var n=r.validateInput("makeLog",o);if(0==n.length){var a=e.makeLog(o);a.$promise.then(r.successCallBack(t),r.errorCallBack(t))}else t(null,n,null)}}};angular.module("myApp.services").factory("logService",["myAppResource","utilsService",logService]);var utilsService=function(e,r,o,t,a,l,s){var i={successCallBack:function(e){return function(r){e(null,null,r)}},errorCallBack:function(e){return function(r){e(r,null,null)}},fetchTemplate:function(t){return r.when(e.get(t)||o.get(t)).then(function(r){return angular.isObject(r)?(e.put(t,r.data),r.data):r})},appendTemplate:function(e,r,o){i.fetchTemplate(o).then(function(o){r.append(t(o)(e))},function(e){console.log(e)})},getRandom:function(e){return Math.floor(Math.pow(10,e-1)+9*Math.random()*Math.pow(10,e-1))},openModal:function(e){return a.open(e)},closeModal:function(e){e.close()},dismissModal:function(e){e.dismiss("cancel")},validateInput:function(e,r){var o=[],t=l.constraints[e][e];if(t){if(r)if(_.isArray(r))_.each(r,function(e){var r=validate(e,t);r&&o.push(r)});else{var n=validate(r,t);n&&o.push(n)}}else o.push("constraints object not found in route configs");return o},logger:function(e,r){switch(e){case"log":l.clientDebug&&s.log(r);break;case"info":l.clientDebug&&s.info(r);break;case"error":s.error(r);break;case"warn":l.clientDebug&&s.warn(r)}},isMobile:function(){return"none"==$(".navbar-brand .navbar-brand__title").css("display")||("inline-block"!=$(".navbar-brand .navbar-brand__title").css("display"),!1)},dataURItoBlob:function(e){var r=e.split(","),o=r[0].match(/:(.*?);/)[1],t=atob(r[1]);for(n=t.length,u8arr=new Uint8Array(n);n--;)u8arr[n]=t.charCodeAt(n);return new Blob([u8arr],{type:o})},isInteger:function(e){return Math.floor(e)===e},isFloat:function(e){return!!(e%1)},validatePassword:function(e){var r=/[!@#$%^&*?_~]/,o=/[a-z]/,t=/[A-Z]/,n=/[0-9]/;return!!(e&&e.length>7&&r.test(e)&&o.test(e)&&t.test(e)&&n.test(e))}};return i};angular.module("myApp.services").factory("utilsService",["$templateCache","$q","$http","$compile","$modal","$rootScope","$log",utilsService]),angular.module("myApp.directives").directive("emailValidator",function(e,r){return{require:"ngModel",restrict:"EA",link:function(o,t,n,a){a.$asyncValidators.emailValidator=function(o,t){var n=/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;if(t&&n.test(t.toLowerCase())){var a=r.validateEmail(t.toLowerCase()),l=e.defer();return a.$promise.then(function(e){e.validEmail?l.resolve():l.reject()},function(r){return e.reject(r)}),l.promise}return e.when()}}}}),angular.module("myApp.directives").directive("passwordValidator",function(){return{require:"ngModel",restrict:"EA",link:function(e,r,o,t){t.$asyncValidators.passwordValidator=function(e,r){console.log(e),console.log(r);var o=/[!@#$%^&*?_~]/,t=/[a-z]/,n=/[A-Z]/,a=/[0-9]/;return!!(r&&r.length>7&&o.test(r)&&t.test(r)&&n.test(r)&&a.test(r))}}}}),angular.module("myApp.directives").directive("usernameValidator",function(e,r){return{require:"ngModel",restrict:"EA",link:function(o,t,n,a){a.$asyncValidators.usernameValidator=function(o,t){if(t&&t.length>4){var n=r.validateUserName(t.toLowerCase()),a=e.defer();return n.$promise.then(function(e){e.validUserName?a.resolve():a.reject()},function(r){return e.reject(r)}),a.promise}return e.when()}}}}),angular.module("myApp.filters").filter("titleCase",function(){return function(e){return null==e?null:void 0!==e?(e=e||"",e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})):null}}).filter("removeUnderSocre",function(){return function(e){return null==e?null:void 0!==e?(e=e.replace("_"," "),e=e||"",e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})):null}}).filter("dob",function(){var e=["January","February","March","April","May","June","July","August","September","October","November","December"];return function(r){if(null==r)return null;if(void 0!==r){var o=new Date(r);return e[o.getMonth()]+", "+o.getDate()}return null}});var headerController=function(e,r,o,t,n,a){e.userProfile=r.account,e.handleLogout=function(){a.logout(function(e,r,o){t.location="/"})}};angular.module("myApp.controllers").controller("headerController",["$scope","$rootScope","$stateParams","$window","utilsService","accountService",headerController]);var landingController=function(e,r,o,t,n,a,l){r.loggedIn===!0&&(t.location="/"),e.user={},e.handleSignInForm=function(e){var r=e;l.signIn(r,function(e,r,o){e?404==e.status?n.error("Invalid email or password",{ttl:5e3}):a.logger("error",e):r?a.logger("error",r):o&&o.data&&(t.location="/")})}};angular.module("myApp.controllers").controller("landingController",["$scope","$rootScope","$stateParams","$window","growl","utilsService","accountService",landingController]);var profileController=function(e,r,o,t,n,a,l){(r.loggedIn===!1||r.account&&"admin"!=r.account.role)&&(t.location="/"),e.userList=[],r.handleUserModal=function(o,t){e.activeUserViewData=angular.copy(o),e.activeUserEditData=angular.copy(o),e.modalUserConfig={modalName:"userModal",animation:!0,templateUrl:"dist/views/modal/userModal",size:"md",backdrop:"static",mode:t,scope:e,controller:function(){}},r.openModal(e.modalUserConfig)},e.handleSignUpForm=function(o){var t=angular.copy(o);delete t.cnfPassword,console.log(t),a.signUp(t,function(o,t,a){o?404==o.status?l.error(o,{ttl:5e3}):n.logger("error",o):t?n.logger("error",t):a&&a.data&&(e.userList.push(a.data),r.closeModal("userModal"),l.success("User registered successfully",{ttl:5e3}))})},e.updateUser=function(o){var t=o;t.adminId=r.account._id,a.updateUser(t,function(o,t,a){o?404==o.status?l.error(o,{ttl:5e3}):n.logger("error",o):t?n.logger("error",t):a&&a.data&&(_.each(e.userList,function(r,o){a.data._id==r._id&&(e.userList[o]=a.data)}),r.closeModal("userModal"),l.success("User profile updated successfully",{ttl:5e3}))})},a.getUserList({_id:r.account._id},function(r,o,t){r?404==r.status?e.userMessage="Invalid User":n.logger("error",r):o?n.logger("error",o):t&&t.data&&(e.userList=t.data)}),r.$on("onlineuser-updated",function(r,o){var t=[];_.each(e.userList,function(e,r){_.each(o,function(r,o){e._id===r.userId&&t.push(e)})}),e.$apply(function(){e.onlineUser=t})})};angular.module("myApp.controllers").controller("profileController",["$scope","$rootScope","$stateParams","$window","utilsService","accountService","growl",profileController]);var signUpController=function(e,r,o,t,n,a,l){r.loggedIn===!0&&(t.location="/"),e.handleSignUpForm=function(e){var r=angular.copy(e);delete r.cnfPassword,l.signUp(r,function(e,r,o){e?404==e.status?n.error(e,{ttl:5e3}):a.logger("error",e):r?a.logger("error",r):o&&o.data&&(n.success("User registered successfully",{ttl:5e3}),t.location="/")})}};angular.module("myApp.controllers").controller("signUpController",["$scope","$rootScope","$stateParams","$window","growl","utilsService","accountService",signUpController]);var userController=function(e,r,o,t,n,a,l){r.loggedIn!==!1&&"admin"!=r.account.role||(t.location="/"),e.userProfile=r.account,e.handleUserModal=function(o,t){e.activeUserViewData=angular.copy(o),e.activeUserEditData=angular.copy(o),e.modalUserConfig={modalName:"userModal",animation:!0,templateUrl:"dist/views/modal/userModal",size:"md",backdrop:"static",mode:t,scope:e,controller:function(){}},r.openModal(e.modalUserConfig)},e.updateUser=function(o){var t=o;a.updateUser(t,function(o,t,a){o?404==o.status?l.error(o,{ttl:5e3}):n.logger("error",o):t?n.logger("error",t):a&&a.data&&(r.closeModal("userModal"),r.account=a.data,e.userProfile=r.account,l.success("User profile updated successfully",{ttl:5e3}))})}};angular.module("myApp.controllers").controller("userController",["$scope","$rootScope","$stateParams","$window","utilsService","accountService","growl",userController]);